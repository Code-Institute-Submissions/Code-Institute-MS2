// quiz.js
// Create variables

let score = 0;
let cat = 0;
let categoryData=0;
let randomQuestionNumber=0;
let randomNumberArray=[];

const startQuiz = document.getElementById("startQuiz");

// Choose a Category - Grab Category from jService

async function category(elem) { // Fetch taken from "https://developers.google.com/web/updates/2015/03/introduction-to-fetch"

    let cat=(elem.id);

    let categoryChoice = document.querySelector('.categoryChoice');
    categoryChoice.style.display = 'none';

    //var c = cat.toString();

    await fetch('https://jservice.io/api/category?id='+cat)
    .then(
      function(response) {
      if (response.status !== 200) {
        console.log('Looks like there was a problem. Status Code: ' +
          response.status);
        alert('Looks like there was a problem. Status Code: ' +
          response.status);
        return;
      }

      // Examine the text in the response
      response.json().then(function(data) {
        categoryData=data;
      });
    }
  )
  .catch(function(err) {
    console.log('Fetch Error :-S', err);
    alert('Fetch Error :-S', err);
  });

  document.getElementById("hostSpeech").innerHTML = "When ready, press the button & I'll ask you a question";

  let quizHost = document.querySelector('.quizHost');
  quizHost.style.backgroundImage ='url("assets/images/quizHost/alien_happy2.png")';

  let startQuiz = document.querySelector('#startQuiz');
  startQuiz.style.display = 'inline-block';
}

// Grabbing a RANDOM Question using a random # generated by a short script - 'Start Quiz' Button could also be called 'Next Question"
// Create random # & check it is unused - We don't want repeat questions
// Each category has a different number of questions
//Unused # pushed to array
 // Use the random # to grab that question
startQuiz.addEventListener('click', function(){

    let startQuiz = document.querySelector('#startQuiz');
    startQuiz.style.display = 'none';

    let quizHost = document.querySelector('.quizHost');
    quizHost.style.backgroundImage ='url("assets/images/quizHost/alien_question1.png")';


    const numberOfQuestions = categoryData.clues_count;
    min = Math.ceil(0);
    max = Math.floor(numberOfQuestions);
    randomQuestionNumber = Math.floor(Math.random() * (max - min + 1) + min);
  
    while (randomNumberArray.includes(randomQuestionNumber)){
        randomQuestionNumber = Math.floor(Math.random() * (max - min + 1) + min);
    }
    
    randomNumberArray.push(randomQuestionNumber);

    const question = categoryData.clues[randomQuestionNumber].question;
    const answer = categoryData.clues[randomQuestionNumber].answer;
    document.getElementById("question").innerHTML = question;
    document.getElementById("answer").innerHTML = answer;
    document.getElementById("hostSpeech").innerHTML = question;

    let userAnswerSubmission = document.querySelector('.userAnswerSubmission');
    userAnswerSubmission.style.display = 'inline-block';
});

//Using enter key to submit answer on form

var input = document.getElementById("userAnswer");

input.addEventListener("keyup", function(event) {
  if (event.keyCode === 13) {
   event.preventDefault();
   checkAnswer();
  }
});

document.getElementById('answerForm').onsubmit = function(e){
    e.preventDefault();
    checkAnswer();
}

// Checking the Answer
// Use stringSimilarity.compareTwoStrings to check the answer
function checkAnswer() {
    const title = categoryData.title;

    var ans = document.getElementById("answer").innerHTML
    var userAns = document.getElementById("userAnswer").value

    var ansLower = ans.toLowerCase();
    var userAnsLower = userAns.toLowerCase();
    
    if (stringSimilarity.compareTwoStrings(ansLower, userAnsLower)>=0.6){
        score++
        document.getElementById("hostSpeech").innerHTML = "Well Done! You got it correct.";

        let quizHost = document.querySelector('.quizHost');
        quizHost.style.backgroundImage ='url("assets/images/quizHost/alien_happy3.png")';
        
        let userAnswerSubmission = document.querySelector('.userAnswerSubmission');
        userAnswerSubmission.style.display = 'none';

        let startQuiz = document.querySelector('#startQuiz');
        startQuiz.style.display = 'initial';
        document.getElementById('startQuiz').innerHTML = 'Next Question';
    } else {
        document.getElementById("hostSpeech").innerHTML = "Oh no! Better luck next time. The answer I was looking for was: " + ans;

        let userAnswerSubmission = document.querySelector('.userAnswerSubmission');
        userAnswerSubmission.style.display = 'none';
        let popUp = document.querySelector('.popUp');
        popUp.style.display = 'inline-block';
        popUp.querySelector('.popUpCategory').innerHTML = 'You chose the ' + title + ' category';
        popUp.querySelector('.popUpScore').innerHTML = 'You got ' + score + ' questions correct!';

        let quizHost = document.querySelector('.quizHost');
        quizHost.style.backgroundImage ='url("assets/images/quizHost/alien_sad1.png")';
    }
    document.getElementById("answerForm").reset(); //reset the form for next question
}


//Restart game
function reloadGame(){
    window.location.reload();
} 

let restartGame = function restartGame() {
    reloadGame();
};